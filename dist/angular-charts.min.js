/**
 * Main module
 */
angular.module("angularCharts",["angularChartsTemplates"]),angular.module("angularCharts").directive("acChart",function(t,n,e,a,r,o){function i(){var t=(Math.round(127*Math.random())+127).toString(16),n=(Math.round(127*Math.random())+127).toString(16),e=(Math.round(127*Math.random())+127).toString(16)
return"#"+t+n+e}function l(t,n){for(var e=null,a=0;a<t.length;a++)if(angular.isElement(t[a])&&(e=angular.element(t[a]),e.hasClass(n)))return e
return e}function s(e,s){function c(){if(d()){m(),p(),f()
var t=h(X)
t(),E()}}function d(){if(D&&R)return!0
if(F.waitForHeightAndWidth)return!1
throw new Error("Please set height and width for the chart element")}function p(){if(!F.legend.display)return S=D,void(L=R)
switch(F.legend.position){case"top":case"bottom":S=.75*D,L=R
break
case"left":case"right":S=D,L=.75*R}}function f(){var a=t.get("angularChartsTemplate_"+F.legend.position)
s.html(a),n(s.contents())(e)
var r=s.find("div")
P=l(r,"ac-chart"),q=l(r,"ac-legend"),S-=l(r,"ac-title")[0].clientHeight}function g(){e.acConfig&&angular.extend(F,e.acConfig)}function m(){H=e.acData,X=e.acChart,W=H?H.series||[]:[],O=H?H.data||[]:[]}function h(t){var n={pie:k,bar:x,line:y,area:b,point:A}
return n[t]}function v(t,n){var e=n.domain()
if(F.xAxisMaxTicks&&e.length>F.xAxisMaxTicks){var a=Math.ceil(e.length/F.xAxisMaxTicks)
t.tickValues(e.filter(function(t,n){return n%a===0}))}}function x(){var t={top:0,right:20,bottom:30,left:40}
L-=t.left+t.right,S-=t.top+t.bottom
var n=d3.scale.ordinal().rangeRoundBands([0,L],.1),a=d3.scale.linear().range([S,10]),r=d3.scale.ordinal().rangeRoundBands([0,L],.1),o=[0]
O.forEach(function(t){t.nicedata=t.y.map(function(n,e){return o.push(n),{x:t.x,y:n,s:e,tooltip:angular.isArray(t.tooltip)?t.tooltip[e]:t.tooltip}})})
var i=d3.max(O.map(function(t){return t.y.length}))
e.yMaxData=i,n.domain(O.map(function(t){return t.x}))
var l=.2*d3.max(o)
a.domain([d3.min(o),d3.max(o)+l]),r.domain(d3.range(i)).rangeRoundBands([0,n.rangeBand()])
var s=d3.svg.axis().scale(n).orient("bottom")
v(s,n)
var u=d3.svg.axis().scale(a).orient("left").ticks(10).tickFormat(d3.format(F.yAxisTickFormat)),c=d3.select(P[0]).append("svg").attr("width",L+t.left+t.right).attr("height",S+t.top+t.bottom).append("g").attr("transform","translate("+t.left+","+t.top+")")
c.append("g").attr("class","x axis").attr("transform","translate(0,"+S+")").call(s),c.append("g").attr("class","y axis").call(u)
var d=c.selectAll(".state").data(O).enter().append("g").attr("class","g").attr("transform",function(t){return"translate("+n(t.x)+",0)"}),p=d.selectAll("rect").data(function(t){return t.nicedata}).enter().append("rect")
p.attr("width",r.rangeBand()),p.attr("x",function(t,n){return r(n)}).attr("y",S).style("fill",function(t){return B(t.s)}).attr("height",0).transition().ease("cubic-in-out").duration(F.isAnimate?1e3:0).attr("y",function(t){return a(Math.max(0,t.y))}).attr("height",function(t){return Math.abs(a(t.y)-a(0))}),p.on("mouseover",function(t){w({index:t.x,value:t.tooltip?t.tooltip:t.y,series:W[t.s]},d3.event),F.mouseover(t,d3.event),e.$apply()}).on("mouseleave",function(t){M(),F.mouseout(t,d3.event),e.$apply()}).on("mousemove",function(t){$(t,d3.event)}).on("click",function(t){F.click.call(t,d3.event),e.$apply()}),F.labels&&d.selectAll("not-a-class").data(function(t){return t.nicedata}).enter().append("text").attr("x",function(t,n){return r(n)}).attr("y",function(t){return S-Math.abs(a(t.y)-a(0))}).text(function(t){return t.y}),c.append("line").attr("x1",L).attr("y1",a(0)).attr("y2",a(0)).style("stroke","silver")}function y(){function t(t){return Math.round(a(t))+a.rangeBand()/2}var n={top:0,right:40,bottom:20,left:40}
L-=n.left+n.right,S-=n.top+n.bottom
var a=d3.scale.ordinal().domain(O.map(function(t){return t.x})).rangeRoundBands([0,L]),r=d3.scale.linear().range([S,10]),o=d3.svg.axis().scale(a).orient("bottom")
v(o,a)
var i=d3.svg.axis().scale(r).orient("left").ticks(5).tickFormat(d3.format(F.yAxisTickFormat)),l=d3.svg.line().interpolate(F.lineCurveType).x(function(n){return t(n.x)}).y(function(t){return r(t.y)}),s=[0],u=[]
O.forEach(function(t){t.y.map(function(t){s.push(t)})})
var c=d3.max(O.map(function(t){return t.y.length}))
e.yMaxData=c,W.slice(0,c).forEach(function(t,n){var e={}
e.series=t,e.values=O.map(function(t){return t.y.map(function(n){return{x:t.x,y:n,tooltip:t.tooltip}})[n]||{x:O[n].x,y:0}}),u.push(e)})
var d=d3.select(P[0]).append("svg").attr("width",L+n.left+n.right).attr("height",S+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")"),p=.2*d3.max(s)
r.domain([d3.min(s),d3.max(s)+p]),d.append("g").attr("class","x axis").attr("transform","translate(0,"+S+")").call(o),d.append("g").attr("class","y axis").call(i)
var f=d.selectAll(".points").data(u).enter().append("g"),g=f.attr("points","points").append("path").attr("class","ac-line").style("stroke",function(t,n){return B(n)}).attr("d",function(t){return l(t.values)}).attr("stroke-width","2").attr("fill","none")
if(u.length>0){var m=u[u.length-1].values
if(m.length>0){var h=g.node().getTotalLength()+t(m[m.length-1].x)
g.attr("stroke-dasharray",h+" "+h).attr("stroke-dashoffset",h).transition().duration(F.isAnimate?1500:0).ease("linear").attr("stroke-dashoffset",0).attr("d",function(t){return l(t.values)})}}return angular.forEach(u,function(n){var a=d.selectAll(".circle").data(n.values).enter()
a.append("circle").attr("cx",function(n){return t(n.x)}).attr("cy",function(t){return r(t.y)}).attr("r",3).style("fill",B(u.indexOf(n))).style("stroke",B(u.indexOf(n))).on("mouseover",function(t){return function(n){w({index:n.x,value:n.tooltip?n.tooltip:n.y,series:t},d3.event),F.mouseover(n,d3.event),e.$apply()}}(n.series)).on("mouseleave",function(t){M(),F.mouseout(t,d3.event),e.$apply()}).on("mousemove",function(){$(d3.event)}).on("click",function(t){F.click(t,d3.event),e.$apply()}),F.labels&&a.append("text").attr("x",function(n){return t(n.x)}).attr("y",function(t){return r(t.y)}).text(function(t){return t.y})}),"lineEnd"===F.lineLegend&&f.append("text").datum(function(t){return{name:t.series,value:t.values[t.values.length-1]}}).attr("transform",function(n){return"translate("+t(n.value.x)+","+r(n.value.y)+")"}).attr("x",3).text(function(t){return t.name}),u}function b(){function t(t){return Math.round(a(t))+a.rangeBand()/2}var n={top:0,right:40,bottom:20,left:40}
L-=n.left+n.right,S-=n.top+n.bottom
var a=d3.scale.ordinal().domain(O.map(function(t){return t.x})).rangePoints([0,L]),r=d3.scale.linear().range([S,10]),o=d3.svg.axis().scale(a).orient("bottom")
v(o,a)
var i=d3.svg.axis().scale(r).orient("left").ticks(5).tickFormat(d3.format(F.yAxisTickFormat))
d3.svg.line().interpolate(F.lineCurveType).x(function(n){return t(n.x)}).y(function(t){return r(t.y)})
var l=[0],s=[]
O.forEach(function(t){t.y.map(function(t){l.push(t)})})
var u=d3.max(O.map(function(t){return t.y.length}))
e.yMaxData=u,W.slice(0,u).forEach(function(t,n){var e={}
e.series=t,e.values=O.map(function(t){return t.y.map(function(n){return{x:t.x,y:n}})[n]||{x:O[n].x,y:0}}),s.push(e)})
var c=d3.select(P[0]).append("svg").attr("width",L+n.left+n.right).attr("height",S+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")"),d=.2*d3.max(l)
r.domain([d3.min(l),d3.max(l)+d]),c.append("g").attr("class","x axis").attr("transform","translate(0,"+S+")").call(o),c.append("g").attr("class","y axis").call(i)
var p=c.selectAll(".points").data(s).enter().append("g"),f=d3.svg.area().interpolate("basis").x(function(n){return t(n.x)}).y0(function(){return r(0)}).y1(function(t){return r(0+t.y)})
p.append("path").attr("class","area").attr("d",function(t){return f(t.values)}).style("fill",function(t,n){return B(n)}).style("opacity","0.7")}function k(){function t(t){t.innerRadius=0
var n=d3.interpolate({startAngle:0,endAngle:0},t)
return function(t){return i(n(t))}}var n=Math.min(L,S)/2,a=d3.select(P[0]).append("svg").attr("width",L).attr("height",S).append("g").attr("transform","translate("+L/2+","+S/2+")"),r=0
if(F.innerRadius){var o=F.innerRadius
o="string"==typeof o&&o.indexOf("%")>0?.01*n*parseFloat(o):Number(o),o>=0&&(r=o)}e.yMaxData=O.length
var i=d3.svg.arc().outerRadius(n-10).innerRadius(r)
d3.svg.arc().outerRadius(n+5).innerRadius(0)
var l=d3.layout.pie().sort(null).value(function(t){return t.y[0]}),s=a.selectAll(".arc").data(l(O)).enter().append("g"),u=!1
s.append("path").style("fill",function(t,n){return B(n)}).transition().ease("linear").duration(F.isAnimate?500:0).attrTween("d",t).attr("class","arc").each("end",function(){u||(u=!0,s.on("mouseover",function(t){w({value:t.data.tooltip?t.data.tooltip:t.data.y[0]},d3.event),d3.select(this).select("path").transition().duration(200).style("stroke","white").style("stroke-width","2px"),F.mouseover(t,d3.event),e.$apply()}).on("mouseleave",function(t){d3.select(this).select("path").transition().duration(200).style("stroke","").style("stroke-width",""),M(),F.mouseout(t,d3.event),e.$apply()}).on("mousemove",function(t){$(t,d3.event)}).on("click",function(t){F.click(t,d3.event),e.$apply()}))}),F.labels&&s.append("text").attr("transform",function(t){return"translate("+i.centroid(t)+")"}).attr("dy",".35em").style("text-anchor","middle").text(function(t){return t.data.y[0]})}function A(){function t(t){return Math.round(a(t))+a.rangeBand()/2}var n={top:0,right:40,bottom:20,left:40}
L-=n.left-n.right,S-=n.top-n.bottom
var a=d3.scale.ordinal().domain(O.map(function(t){return t.x})).rangeRoundBands([0,L]),r=d3.scale.linear().range([S,10]),o=d3.svg.axis().scale(a).orient("bottom")
v(o,a)
var i=d3.svg.axis().scale(r).orient("left").ticks(5).tickFormat(d3.format(F.yAxisTickFormat)),l=[0],s=[]
O.forEach(function(t){t.y.map(function(t){l.push(t)})})
var u=d3.max(O.map(function(t){return t.y.length}))
e.yMaxPoints=u,W.slice(0,u).forEach(function(t,n){var e={}
e.series=t,e.values=O.map(function(t){return t.y.map(function(n){return{x:t.x,y:n}})[n]||{x:O[n].x,y:0}}),s.push(e)})
var c=d3.select(P[0]).append("svg").attr("width",L+n.left+n.right).attr("height",S+n.top+n.bottom).append("g").attr("transform","translate("+n.left+","+n.top+")"),d=.2*d3.max(l)
r.domain([d3.min(l),d3.max(l)+d]),c.append("g").attr("class","x axis").attr("transform","translate(0,"+S+")").call(o),c.append("g").attr("class","y axis").call(i),c.selectAll(".points").data(s).enter().append("g"),angular.forEach(s,function(n){var a=c.selectAll(".circle").data(n.values).enter()
a.append("circle").attr("cx",function(n){return t(n.x)}).attr("cy",function(t){return r(t.y)}).attr("r",3).style("fill",B(s.indexOf(n))).style("stroke",B(s.indexOf(n))).on("mouseover",function(t){return function(n){w({index:n.x,value:n.tooltip?n.tooltip:n.y,series:t},d3.event),F.mouseover(n,d3.event),e.$apply()}}(n.series)).on("mouseleave",function(t){M(),F.mouseout(t,d3.event),e.$apply()}).on("mousemove",function(){$(d3.event)}).on("click",function(t){F.click(t,d3.event),e.$apply()}),F.labels&&a.append("text").attr("x",function(n){return t(n.x)}).attr("y",function(t){return r(t.y)}).text(function(t){return t.y})})}function w(t,n){if(F.tooltips){t="function"==typeof F.tooltips?F.tooltips(t):t.value
var a=angular.element('<p class="ac-tooltip"></p>').html(t).css({left:n.pageX+20+"px",top:n.pageY-30+"px"})
angular.element(document.querySelector(".ac-tooltip")).remove(),angular.element(document.body).append(a),e.$tooltip=a}}function M(){e.$tooltip&&e.$tooltip.remove()}function $(t,n){e.$tooltip&&e.$tooltip.css({left:n.pageX+20+"px",top:n.pageY-30+"px"})}function E(){e.legends=[],"pie"===X&&angular.forEach(O,function(t,n){e.legends.push({color:F.colors[n],title:T(t.x)})}),("bar"===X||"area"===X||"point"===X||"line"===X&&"traditional"===F.lineLegend)&&angular.forEach(W,function(t,n){e.legends.push({color:F.colors[n],title:T(t)})})}function C(t){return String(t).replace(/[&<>"'\/]/g,function(t){return Y[t]})}function T(t){return o.trustAsHtml(F.legend.htmlEnabled?t:C(t))}function B(t){if(t<F.colors.length)return F.colors[t]
var n=i()
return F.colors.push(n),n}var F={title:"",tooltips:!0,labels:!1,mouseover:function(){},mouseout:function(){},click:function(){},legend:{display:!0,position:"left",htmlEnabled:!1},colors:u,innerRadius:0,lineLegend:"lineEnd",lineCurveType:"cardinal",isAnimate:!0,yAxisTickFormat:"s",waitForHeightAndWidth:!1}
g()
var R=s[0].clientWidth,D=s[0].clientHeight
d()
var H,W,O,S,L,P,q,X,Y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},z=angular.element(a),N=null
z.bind("resize",function(){N&&r.cancel(N),N=r(function(){R=s[0].clientWidth,D=s[0].clientHeight,c()},100)}),e.getWindowDimensions=function(){return{h:z[0].clientHeight,w:z[0].clientWidth}},e.$watch("[acChart, acData, acConfig]",c,!0),e.$watch(function(){return{w:s[0].clientWidth,h:s[0].clientHeight}},function(t){R=t.w,D=t.h,c()},!0)}var u=["rgb(255,153,0)","rgb(220,57,18)","rgb(70,132,238)","rgb(73,66,204)","rgb(0,128,0)","rgb(0, 169, 221)","steelBlue","rgb(0, 169, 221)","rgb(50, 205, 252)","rgb(70,132,238)","rgb(0, 169, 221)","rgb(5, 150, 194)","rgb(50, 183, 224)","steelBlue","rgb(2, 185, 241)","rgb(0, 169, 221)","steelBlue","rgb(0, 169, 221)","rgb(50, 205, 252)","rgb(70,132,238)","rgb(0, 169, 221)","rgb(5, 150, 194)","rgb(50, 183, 224)","steelBlue","rgb(2, 185, 241)"]
return{restrict:"EA",link:s,transclude:"true",scope:{acChart:"=",acData:"=",acConfig:"="}}})
